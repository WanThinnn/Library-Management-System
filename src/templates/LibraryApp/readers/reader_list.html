{% extends 'base.html' %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>ğŸ“š {{ page_title }}</h2>
        <a href="{% url 'reader_create' %}" class="btn">
            â• Láº­p tháº» má»›i
        </a>
    </div>
    
    <!-- Filters -->
    <form method="get" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
        <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; align-items: end;">
            <div>
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">TÃ¬m kiáº¿m:</label>
                <input type="text" name="search" value="{{ request.GET.search }}" 
                       placeholder="TÃªn hoáº·c email..." 
                       style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            <div>
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Loáº¡i Ä‘á»™c giáº£:</label>
                <select name="reader_type" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="">-- Táº¥t cáº£ --</option>
                    {% for rt in reader_types %}
                    <option value="{{ rt.id }}" {% if request.GET.reader_type == rt.id|stringformat:"s" %}selected{% endif %}>
                        {{ rt.reader_type_name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <button type="submit" class="btn" style="padding: 8px 20px;">
                    ğŸ” Lá»c
                </button>
            </div>
        </div>
    </form>
    
    <!-- Readers table -->
    {% if readers %}
    <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse; background: white;">
            <thead>
                <tr style="background: #3498db; color: white;">
                    <th style="padding: 12px; text-align: left; border: 1px solid #2980b9;">MÃ£</th>
                    <th style="padding: 12px; text-align: left; border: 1px solid #2980b9;">Há» tÃªn</th>
                    <th style="padding: 12px; text-align: left; border: 1px solid #2980b9;">Loáº¡i ÄG</th>
                    <th style="padding: 12px; text-align: left; border: 1px solid #2980b9;">Tuá»•i</th>
                    <th style="padding: 12px; text-align: left; border: 1px solid #2980b9;">Email</th>
                    <th style="padding: 12px; text-align: left; border: 1px solid #2980b9;">NgÃ y láº­p tháº»</th>
                    <th style="padding: 12px; text-align: left; border: 1px solid #2980b9;">Háº¡n tháº»</th>
                    <th style="padding: 12px; text-align: center; border: 1px solid #2980b9;">Tráº¡ng thÃ¡i</th>
                    <th style="padding: 12px; text-align: center; border: 1px solid #2980b9;">Thao tÃ¡c</th>
                </tr>
            </thead>
            <tbody>
                {% for reader in readers %}
                <tr style="border-bottom: 1px solid #ddd;">
                    <td style="padding: 12px; border: 1px solid #ddd;">{{ reader.id }}</td>
                    <td style="padding: 12px; border: 1px solid #ddd; font-weight: bold;">{{ reader.reader_name }}</td>
                    <td style="padding: 12px; border: 1px solid #ddd;">{{ reader.reader_type.reader_type_name }}</td>
                    <td style="padding: 12px; border: 1px solid #ddd;">{{ reader.age }} tuá»•i</td>
                    <td style="padding: 12px; border: 1px solid #ddd;">{{ reader.email }}</td>
                    <td style="padding: 12px; border: 1px solid #ddd;">{{ reader.card_creation_date|date:"d/m/Y" }}</td>
                    <td style="padding: 12px; border: 1px solid #ddd;">
                        {{ reader.expiration_date|date:"d/m/Y" }}
                        {% if reader.is_card_expired %}
                            <br><span style="color: #c62828; font-size: 0.85em;">âš ï¸ Háº¿t háº¡n</span>
                        {% endif %}
                    </td>
                    <td style="padding: 12px; text-align: center; border: 1px solid #ddd;">
                        {% if reader.is_active %}
                            <span style="background: #27ae60; color: white; padding: 5px 10px; border-radius: 15px; font-size: 0.85em;">
                                âœ… Hoáº¡t Ä‘á»™ng
                            </span>
                        {% else %}
                            <span style="background: #e74c3c; color: white; padding: 5px 10px; border-radius: 15px; font-size: 0.85em;">
                                âŒ KhÃ³a
                            </span>
                        {% endif %}
                    </td>
                    <td style="padding: 12px; text-align: center; border: 1px solid #ddd;">
                        <a href="{% url 'reader_detail' reader.id %}" 
                           style="background: #3498db; color: white; padding: 5px 15px; border-radius: 4px; text-decoration: none; font-size: 0.9em;">
                            ğŸ‘ï¸ Xem
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <div style="margin-top: 15px; color: #666; font-size: 0.9em;">
        Tá»•ng sá»‘: <strong>{{ readers.count }}</strong> Ä‘á»™c giáº£
    </div>
    {% else %}
    <div style="text-align: center; padding: 40px; background: #f8f9fa; border-radius: 8px;">
        <p style="font-size: 1.2em; color: #666;">ğŸ“­ ChÆ°a cÃ³ Ä‘á»™c giáº£ nÃ o</p>
        <a href="{% url 'reader_create' %}" class="btn" style="margin-top: 15px;">
            â• Láº­p tháº» Ä‘á»™c giáº£ Ä‘áº§u tiÃªn
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}
