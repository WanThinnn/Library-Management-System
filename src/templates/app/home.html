{% extends 'base.html' %} {% block content %} {% if user.is_authenticated %}
<!-- Welcome Header -->
<div class="mb-8">
  <h1 class="text-3xl font-bold mb-2 flex items-center flex-wrap gap-2 text-gray-900 dark:text-gray-100">
    Chào mừng, {{ user.username }} {% if user.is_superuser %}
    <span
      class="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-sm font-medium px-3 py-1 rounded-full"
      >Quản trị viên</span
    >
    {% elif user.is_staff %}
    <span
      class="bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 text-sm font-medium px-3 py-1 rounded-full"
      >Nhân viên</span
    >
    {% endif %}
  </h1>
  <p class="text-gray-600 dark:text-gray-400">Tổng quan hệ thống quản lý thư viện</p>
</div>

<!-- Dashboard Stats -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
  <!-- Stat Card 1 - Độc giả -->
  <div
    class="p-6 bg-gradient-to-br from-blue-500 to-blue-700 rounded-xl shadow-lg text-white"
  >
    <div class="text-center">
      <div class="text-5xl font-bold mb-2">{{ total_readers|default:"0" }}</div>
      <div class="text-lg opacity-90 font-medium">Độc giả</div>
    </div>
  </div>

  <!-- Stat Card 2 - Sách -->
  <div
    class="p-6 bg-gradient-to-br from-pink-500 to-rose-600 rounded-xl shadow-lg text-white"
  >
    <div class="text-center">
      <div class="text-5xl font-bold mb-2">{{ total_books|default:"0" }}</div>
      <div class="text-lg opacity-90 font-medium">Đầu sách</div>
    </div>
  </div>

  <!-- Stat Card 3 - Đang mượn -->
  <div
    class="p-6 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-xl shadow-lg text-white"
  >
    <div class="text-center">
      <div class="text-5xl font-bold mb-2">
        {{ active_borrows|default:"0" }}
      </div>
      <div class="text-lg opacity-90 font-medium">Đang mượn</div>
    </div>
  </div>

  <!-- Stat Card 4 - Quá hạn -->
  <div
    class="p-6 bg-gradient-to-br from-red-500 to-orange-600 rounded-xl shadow-lg text-white"
  >
    <div class="text-center">
      <div class="text-5xl font-bold mb-2">{{ overdue_books|default:"0" }}</div>
      <div class="text-lg opacity-90 font-medium">Quá hạn</div>
    </div>
  </div>
</div>

<!-- Quick Actions -->
<div class="mb-12">
  <h2 class="text-2xl font-bold mb-6 text-gray-800 dark:text-gray-200">Tính năng chính</h2>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
    {% if can_view_readers or can_add_readers %}
    <!-- Độc giả - 2 items, no pagination needed -->
    <div class="bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 rounded-xl shadow-sm hover:shadow-md transition-shadow duration-200 overflow-hidden">
      <div class="p-6">
        <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-gray-200 border-b dark:border-gray-700 pb-2">Quản lý Độc giả</h3>
        <div class="flex flex-col space-y-3">
          {% if can_add_readers %}<a href="{% url 'reader_create' %}" class="text-white bg-blue-600 dark:bg-blue-700 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-colors">Lập thẻ độc giả</a>{% endif %}
          {% if can_view_readers %}<a href="{% url 'reader_list' %}" class="text-blue-700 dark:text-blue-400 bg-white dark:bg-gray-800 border border-blue-600 hover:bg-blue-50 dark:bg-blue-900 dark:hover:bg-blue-900 font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-colors">Danh sách độc giả</a>{% endif %}
        </div>
      </div>
    </div>
    {% endif %}

    {% if can_view_books or can_add_books %}
    <!-- Sách - 3 items, needs pagination -->
    <div class="bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 rounded-xl shadow-sm hover:shadow-md transition-shadow duration-200 overflow-hidden">
      <div class="p-6">
        <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-gray-200 border-b dark:border-gray-700 pb-2">Quản lý Sách</h3>
        <div class="card-carousel" data-current="0">
          <div class="flex flex-col space-y-3">
            <!-- Page 1 -->
            <div class="carousel-page">
              {% if can_add_books %}<a href="{% url 'book_import' %}" class="block text-white bg-emerald-600 hover:bg-emerald-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-colors mb-3">Tiếp nhận sách</a>{% endif %}
              {% if can_view_books %}<a href="{% url 'book_search' %}" class="block text-emerald-700 dark:text-emerald-400 bg-white dark:bg-gray-800 border border-emerald-600 hover:bg-emerald-50 dark:hover:bg-emerald-900 font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-colors">Tra cứu sách</a>{% endif %}
            </div>
            {% if can_add_books %}
            <!-- Page 2 -->
            <div class="carousel-page hidden">
              <a href="{% url 'book_import_list' %}" class="block text-white bg-emerald-600 hover:bg-emerald-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-colors">DS phiếu nhập sách</a>
            </div>
            {% endif %}
          </div>
          {% if can_add_books %}
          <div class="flex justify-center items-center gap-2 mt-3 pt-2 border-t border-gray-100 dark:border-gray-700">
            <button class="carousel-prev p-1 text-gray-400 hover:text-gray-600 dark:text-gray-400 disabled:opacity-30" disabled>‹</button>
            <span class="carousel-indicator text-xs text-gray-500">1/2</span>
            <button class="carousel-next p-1 text-gray-400 hover:text-gray-600 dark:text-gray-400">›</button>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    {% endif %}

    {% if can_view_borrow or can_add_borrow or can_view_return or can_add_return %}
    <!-- Mượn/Trả - 4 items, needs pagination -->
    <div class="bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 rounded-xl shadow-sm hover:shadow-md transition-shadow duration-200 overflow-hidden">
      <div class="p-6">
        <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-gray-200 border-b dark:border-gray-700 pb-2">Mượn / Trả Sách</h3>
        <div class="card-carousel" data-current="0">
          <div class="flex flex-col space-y-3">
            <!-- Page 1 -->
            <div class="carousel-page">
              {% if can_add_borrow %}<a href="{% url 'borrow_book' %}" class="block text-white bg-purple-600 hover:bg-purple-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-colors mb-3">Lập phiếu mượn</a>{% endif %}
              {% if can_add_return %}<a href="{% url 'return_book' %}" class="block text-purple-700 dark:text-purple-400 bg-white dark:bg-gray-800 border border-purple-600 hover:bg-purple-50 dark:bg-purple-900 font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-colors">Lập phiếu trả</a>{% endif %}
            </div>
            <!-- Page 2 -->
            <div class="carousel-page hidden">
              {% if can_view_borrow %}<a href="{% url 'borrow_book_list' %}" class="block text-white bg-purple-600 border-purple-600 hover:bg-purple-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-colors mb-3">DS phiếu mượn</a>{% endif %}
              {% if can_view_return %}<a href="{% url 'return_book_list' %}" class="block text-purple-700 dark:text-purple-400 bg-white dark:bg-gray-800 border border-purple-600 hover:bg-purple-50 dark:bg-purple-900 font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-colors">DS phiếu trả</a>{% endif %}
            </div>
          </div>
          <div class="flex justify-center items-center gap-2 mt-3 pt-2 border-t border-gray-100 dark:border-gray-700">
            <button class="carousel-prev p-1 text-gray-400 hover:text-gray-600 dark:text-gray-400 disabled:opacity-30" disabled>‹</button>
            <span class="carousel-indicator text-xs text-gray-500">1/2</span>
            <button class="carousel-next p-1 text-gray-400 hover:text-gray-600 dark:text-gray-400">›</button>
          </div>
        </div>
      </div>
    </div>
    {% endif %}

    {% if can_view_receipt or can_add_receipt or can_view_reports %}
    <!-- Thu tiền & Báo cáo - 4 items, needs pagination -->
    <div class="bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 rounded-xl shadow-sm hover:shadow-md transition-shadow duration-200 overflow-hidden">
      <div class="p-6">
        <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-gray-200 border-b dark:border-gray-700 pb-2">Thu Tiền & Báo cáo</h3>
        <div class="card-carousel" data-current="0">
          <div class="flex flex-col space-y-3">
            <!-- Page 1 -->
            <div class="carousel-page">
              {% if can_add_receipt %}<a href="{% url 'receipt_form' %}" class="block text-white bg-orange-500 hover:bg-orange-600 font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-colors mb-3">Lập phiếu thu</a>{% endif %}
              {% if can_view_reports %}<a href="{% url 'report_borrow_by_category' %}" class="block text-orange-600 bg-white dark:bg-gray-800 border border-orange-500 hover:bg-orange-100 font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-colors">BC mượn theo thể loại</a>{% endif %}
            </div>
            {% if can_view_receipt or can_view_reports %}
            <!-- Page 2 -->
            <div class="carousel-page hidden">
              {% if can_view_receipt %}<a href="{% url 'receipt_list' %}" class="block text-white bg-orange-500 border-orange-500 hover:bg-orange-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-colors mb-3">DS phiếu thu</a>{% endif %}
              {% if can_view_reports %}<a href="{% url 'report_overdue_books' %}" class="block text-orange-600 bg-white dark:bg-gray-800 border border-orange-500 hover:bg-orange-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-colors">BC sách trả trễ</a>{% endif %}
            </div>
            {% endif %}
            {% if can_view_reports %}
            <!-- Page 3 -->
            <div class="carousel-page hidden">
              <a href="{% url 'report_borrow_situation' %}" class="block text-white bg-orange-500 border-orange-500 hover:bg-orange-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-colors mb-3">BC tình hình mượn sách</a>
            </div>
            {% endif %}
          </div>
          <div class="flex justify-center items-center gap-2 mt-3 pt-2 border-t border-gray-100 dark:border-gray-700">
            <button class="carousel-prev p-1 text-gray-400 hover:text-gray-600 dark:text-gray-400 disabled:opacity-30" disabled>‹</button>
            <span class="carousel-indicator text-xs text-gray-500">1/3</span>
            <button class="carousel-next p-1 text-gray-400 hover:text-gray-600 dark:text-gray-400">›</button>
          </div>
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</div>

<script>
document.querySelectorAll('.card-carousel').forEach(carousel => {
  const pages = carousel.querySelectorAll('.carousel-page');
  const prevBtn = carousel.querySelector('.carousel-prev');
  const nextBtn = carousel.querySelector('.carousel-next');
  const indicator = carousel.querySelector('.carousel-indicator');
  let current = 0;
  const total = pages.length;

  function update() {
    pages.forEach((p, i) => p.classList.toggle('hidden', i !== current));
    indicator.textContent = `${current + 1}/${total}`;
    prevBtn.disabled = current === 0;
    nextBtn.disabled = current === total - 1;
  }

  prevBtn?.addEventListener('click', () => { if (current > 0) { current--; update(); } });
  nextBtn?.addEventListener('click', () => { if (current < total - 1) { current++; update(); } });
});
</script>

<!-- Admin Section -->
{% if user.is_superuser %}
<div class="bg-gray-800 text-white rounded-xl shadow-lg overflow-hidden">
  <div class="p-8">
    <h2 class="text-2xl font-bold mb-6">Quản trị Hệ thống</h2>
    <div class="flex flex-wrap gap-4">
      <a
        href="{% url 'parameter_update' %}"
        class="text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-800 hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-700 focus:ring-4 focus:ring-gray-200 font-medium rounded-lg text-sm px-5 py-2.5 text-center"
        >Thay đổi quy định</a
      >
      <a
        href="{% url 'user_list' %}"
        class="text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-800 hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-700 focus:ring-4 focus:ring-gray-200 font-medium rounded-lg text-sm px-5 py-2.5 text-center"
        >Quản lý người dùng</a
      >
      <a
        href="/admin/"
        class="text-white border border-white hover:bg-white dark:bg-gray-800 hover:text-gray-900 dark:text-gray-100 focus:ring-4 focus:ring-gray-500 font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-colors"
        >Admin Panel</a
      >
    </div>
  </div>
</div>
{% endif %} {% else %}
<!-- Unauthenticated View with Background -->
{% load static %}
<div class="fixed inset-0 -z-10 bg-cover bg-center bg-no-repeat" style="background-image: url('{% static 'image/background.jpg' %}');"></div>
<div class="fixed inset-0 -z-10 bg-black/50"></div>

<div class="text-center py-20 px-4 min-h-[70vh] flex flex-col justify-center items-center">
  <h1
    class="text-4xl md:text-5xl font-extrabold mb-4 text-white tracking-tight drop-shadow-lg"
  >
    Hệ thống Quản lý Thư viện
  </h1>
  <p class="text-xl text-gray-100 mb-10 max-w-2xl mx-auto drop-shadow-md">
    Vui lòng đăng nhập để sử dụng các chức năng quản lý, tra cứu và báo cáo.
  </p>
  <div class="flex gap-4 justify-center flex-wrap">
    <a
      href="{% url 'login' %}"
      class="text-white bg-blue-600 dark:bg-blue-700 hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-lg px-8 py-3 shadow-lg transition-all"
      >Đăng nhập</a
    >
    <a
      href="/admin/"
      class="text-white bg-white dark:bg-gray-800/20 backdrop-blur-sm border border-white/50 hover:bg-white dark:bg-gray-800/30 focus:ring-4 focus:ring-white/30 font-medium rounded-lg text-lg px-8 py-3 shadow-lg transition-all"
      >Admin Panel</a
    >
  </div>
</div>
{% endif %} {% endblock %}
