{% extends 'base.html' %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<!-- Header -->
<div class="bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 dark:border-gray-700 mb-6">
    <div class="p-6">
        <h1 class="text-4xl font-bold text-gray-900 dark:text-gray-100 mb-2">
            {{ page_title }}
        </h1>
        <p class="text-gray-500">
            {% if is_admin %}
                Bạn có thể chỉnh sửa tất cả thông tin sách
            {% else %}
                Bạn chỉ có thể chỉnh sửa thông tin cơ bản (số lượng, ISBN, phiên bản, ngôn ngữ)
            {% endif %}
        </p>
    </div>
</div>

<!-- Form chỉnh sửa -->
<div class="bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 dark:border-gray-700 mb-6 overflow-hidden">
    <div class="bg-blue-600 dark:bg-blue-700 text-white px-4 py-3 flex justify-between items-center">
        <h5 class="font-semibold">Thông tin sách</h5>
        <span class="bg-white/20 text-white text-sm font-medium px-3 py-1 rounded-full">
            Mã Sách: {{ book.id }}
        </span>
    </div>
    <div class="p-6">
        <form method="POST">
            {% csrf_token %}
            
            <!-- Thông tin tựa sách (chỉ hiển thị, không chỉnh sửa) -->
            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4">
                <h6 class="font-semibold text-blue-600 mb-4 dark:text-blue-400">Thông tin tựa sách</h6>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Tên sách</label>
                        <input type="text" value="{{ book.book_title.book_title }}" class="form-control bg-gray-100 dark:bg-gray-600 dark:text-gray-200" readonly>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Thể loại</label>
                        <input type="text" value="{{ book.book_title.category.category_name }}" class="form-control bg-gray-100 dark:bg-gray-600 dark:text-gray-200" readonly>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Tác giả</label>
                        <div class="flex flex-wrap gap-2 p-2 bg-gray-100 dark:bg-gray-600 dark:text-gray-300 rounded-lg min-h-[42px]">
                            {% for author in book.book_title.authors.all %}
                                <span class="bg-blue-100 dark:bg-blue-800 text-blue-800 dark:text-blue-500 text-sm px-3 py-1 rounded-full">{{ author.author_name }}</span>
                            {% empty %}
                                <span class="text-gray-500 dark:text-gray-400 italic">Chưa có thông tin tác giả</span>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- Mô tả sách - Có thể chỉnh sửa -->
                    <div class="md:col-span-2">
                        <label for="description" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            Mô tả sách <span class="text-gray-400 text-xs">(tùy chọn)</span>
                        </label>
                        <textarea name="description" id="description" rows="3" 
                            class="form-control w-full" 
                            placeholder="Nhập mô tả về nội dung sách...">{{ book.book_title.description|default:"" }}</textarea>
                    </div>
                </div>
            </div>
            
            <!-- Số lượng -->
            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4">
                <h6 class="font-semibold text-green-600 mb-4 dark:text-green-400">Thông tin số lượng</h6>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="{{ form.quantity.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            Số lượng tổng <span class="text-red-500">*</span>
                        </label>
                        {{ form.quantity }}
                        <p class="text-gray-500 text-xs mt-1">Tổng số cuốn sách trong thư viện</p>
                    </div>
                    <div>
                        <label for="{{ form.remaining_quantity.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            Số lượng còn lại <span class="text-red-500">*</span>
                        </label>
                        {{ form.remaining_quantity }}
                        <p class="text-gray-500 text-xs mt-1">Số cuốn còn sẵn sàng cho mượn</p>
                    </div>
                </div>
            </div>
            
            <!-- Thông tin bổ sung -->
            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4">
                <h6 class="font-semibold text-blue-600 mb-4 dark:text-blue-400">Thông tin bổ sung</h6>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label for="{{ form.isbn.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            ISBN
                        </label>
                        {{ form.isbn }}
                    </div>
                    <div>
                        <label for="{{ form.edition.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            Phiên bản
                        </label>
                        {{ form.edition }}
                    </div>
                    <div>
                        <label for="{{ form.language.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            Ngôn ngữ
                        </label>
                        {{ form.language }}
                    </div>
                </div>
            </div>
            
            <!-- Thông tin nâng cao (Readonly - Chỉnh sửa qua Admin Panel) -->
            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4">
                <h6 class="font-semibold text-purple-600 mb-4 dark:text-purple-400">
                    Thông tin nâng cao
                    <span class="text-gray-400 text-xs font-normal">(Chỉ xem)</span>
                </h6>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            Đơn giá (VNĐ)
                        </label>
                        <input type="text" value="{{ book.unit_price|floatformat:0 }}" class="form-control bg-gray-100 dark:bg-gray-600 dark:text-gray-200" readonly>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            Năm xuất bản
                        </label>
                        <input type="text" value="{{ book.publish_year }}" class="form-control bg-gray-100 dark:bg-gray-600 dark:text-gray-200" readonly>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            Nhà xuất bản
                        </label>
                        <input type="text" value="{{ book.publisher }}" class="form-control bg-gray-100 dark:bg-gray-600 dark:text-gray-200" readonly>
                    </div>
                </div>
                
                <!-- Notice: Admin Panel -->
                {% if is_admin %}
                <div class="mt-4 p-3 bg-amber-50 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-700 rounded-lg">
                    <p class="text-sm text-amber-800 dark:text-amber-300">
                        <strong>Lưu ý:</strong> Để chỉnh sửa thông tin nâng cao (đơn giá, năm XB, NXB, thể loại, tác giả...), vui lòng truy cập 
                        <a href="/admin/LibraryApp/book/{{ book.id }}/change/" class="text-blue-600 dark:text-blue-400 underline hover:no-underline font-medium" target="_blank">
                            Django Admin Panel →
                        </a>
                    </p>
                </div>
                {% endif %}
            </div>
            
            <!-- Buttons -->
            <div class="flex justify-center gap-3 mt-6">
                <a href="{% url 'book_detail' book.id %}" class="hover:scale-105 duration-200 transition-transform bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                    Hủy
                </a>
                <button type="submit" class="hover:scale-105 duration-200 transition-transform bg-blue-600 dark:bg-blue-700 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                    Lưu thay đổi
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
