{% extends 'base.html' %} {% load static %} {% block title %}{{ page_title }}{%endblock %} {% block content %}
<!-- Page Header -->
{% comment %}
<div class="mb-8">
  <h1 class="text-3xl font-bold text-gray-900 mb-2">Tiếp nhận sách mới</h1>
  <p class="text-gray-500">YC2 - Nhập sách vào thư viện</p>
</div>
{% endcomment %}
<div class="bg-white rounded-lg shadow-md border border-gray-200 mb-6">
  <div class="p-6">
    <h1 class="text-4xl font-bold text-gray-900 mb-2">{{ page_title }}</h1>

    <p class="text-gray-500"><strong>YC2:</strong> Nhập sách vào thư viện</p>

    {% comment %} <div
      class="bg-blue-50 border-l-4 border-blue-500 text-blue-700 p-4 rounded mb-6 mt-4"
    >
      <p>
        <strong>Quy định (QĐ2):</strong> Chỉ nhận sách xuất bản từ năm
        <strong>{{ min_year }}</strong> trở đi. Phải có thể loại, ít nhất 1 tác
        giả, và nhà xuất bản.
      </p>
    </div> {% endcomment %}
  </div>
</div>

<!-- Form Card -->
<div class="bg-white rounded-lg shadow-md border border-gray-200 mb-6">
  <div class="p-6">
    <h3 class="text-xl font-semibold text-gray-900 mb-6">Thông tin sách</h3>

    <form method="post">
      {% csrf_token %}

      <!-- Messages -->
      {% if messages %} {% for message in messages %}
      <div
        class="{% if message.tags == 'success' %}bg-green-50 border-l-4 border-green-500 text-green-700{% elif message.tags == 'error' %}bg-red-50 border-l-4 border-red-500 text-red-700{% else %}bg-blue-50 border-l-4 border-blue-500 text-blue-700{% endif %} p-4 rounded mb-4"
      >
        {{ message }}
      </div>
      {% endfor %} {% endif %} {% if form.non_field_errors %}
      <div
        class="bg-red-50 border-l-4 border-red-500 text-red-700 p-4 rounded mb-4"
      >
        {% for error in form.non_field_errors %}{{ error }}{% endfor %}
      </div>
      {% endif %}

      <!-- Book Title -->
      <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >{{ form.book_title.label }}
          <span class="text-red-500">*</span></label
        >
        {{ form.book_title }} {% if form.book_title.errors %}
        <p class="text-red-500 text-sm mt-1">
          {% for e in form.book_title.errors %}{{ e }}{% endfor %}
        </p>
        {% endif %}
      </div>

      <!-- Row: Category, Publisher -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >{{ form.category.label }}
            <span class="text-red-500">*</span></label
          >
          {{ form.category }} {% if form.category.errors %}
          <p class="text-red-500 text-sm mt-1">
            {% for e in form.category.errors %}{{ e }}{% endfor %}
          </p>
          {% endif %}
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >{{ form.publisher.label }}
            <span class="text-red-500">*</span></label
          >
          {{ form.publisher }} {% if form.publisher.errors %}
          <p class="text-red-500 text-sm mt-1">
            {% for e in form.publisher.errors %}{{ e }}{% endfor %}
          </p>
          {% endif %}
        </div>
      </div>

      <!-- Row: Year, Language, ISBN, Edition -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >{{ form.publish_year.label }}
            <span class="text-red-500">*</span></label
          >
          {{ form.publish_year }} {% if form.publish_year.errors %}
          <p class="text-red-500 text-sm mt-1">
            {% for e in form.publish_year.errors %}{{ e }}{% endfor %}
          </p>
          {% endif %}
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >{{ form.language.label }}</label
          >
          {{ form.language }}
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >{{ form.isbn.label }}</label
          >
          {{ form.isbn }}
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >{{ form.edition.label }}</label
          >
          {{ form.edition }}
        </div>
      </div>

      <!-- Authors -->
      <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >{{ form.authors.label }} <span class="text-red-500">*</span></label
        >
        <div
          class="border border-gray-300 rounded-lg p-3 max-h-40 overflow-y-auto bg-gray-50"
        >
          <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
            {% for widget in form.authors %}
            <div class="flex items-center text-sm">{{ widget }}</div>
            {% endfor %}
          </div>
        </div>
        {% if form.authors.errors %}
        <p class="text-red-500 text-sm mt-1">
          {% for e in form.authors.errors %}{{ e }}{% endfor %}
        </p>
        {% endif %}
      </div>

      <!-- Description -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >{{ form.description.label }}</label
        >
        {{ form.description }}
      </div>

      <!-- Divider -->
      <hr class="my-6" />
      <h3 class="text-xl font-semibold text-gray-900 mb-6">
        Thông tin nhập kho
      </h3>

      <!-- Row: Quantity, Price, Date -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >{{ form.quantity.label }}
            <span class="text-red-500">*</span></label
          >
          {{ form.quantity }} {% if form.quantity.errors %}
          <p class="text-red-500 text-sm mt-1">
            {% for e in form.quantity.errors %}{{ e }}{% endfor %}
          </p>
          {% endif %}
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >{{ form.unit_price.label }}
            <span class="text-red-500">*</span></label
          >
          {{ form.unit_price }} {% if form.unit_price.errors %}
          <p class="text-red-500 text-sm mt-1">
            {% for e in form.unit_price.errors %}{{ e }}{% endfor %}
          </p>
          {% endif %}
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >{{ form.import_date.label }}
            <span class="text-red-500">*</span></label
          >
          {{ form.import_date }} {% if form.import_date.errors %}
          <p class="text-red-500 text-sm mt-1">
            {% for e in form.import_date.errors %}{{ e }}{% endfor %}
          </p>
          {% endif %}
        </div>
      </div>

      <!-- Notes -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >{{ form.notes.label }}</label
        >
        {{ form.notes }}
      </div>

      <!-- Buttons -->
      <div class="flex gap-3">
        <button
          type="submit"
          class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors"
          onclick="ensureValues()"
        >
          Lưu phiếu nhập
        </button>
        <a
          href="{% url 'book_import_list' %}"
          class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition-colors"
        >
          Xem danh sách
        </a>
        {% comment %}
        <a
          href="{% url 'home' %}"
          class="border border-gray-300 hover:bg-gray-50 text-gray-700 font-medium py-2 px-4 rounded-lg transition-colors"
        >
          Về trang chủ
        </a>
        {% endcomment %}
      </div>
    </form>
  </div>
</div>

<script>
  function ensureValues() {
    const quantityField = document.querySelector('input[name="quantity"]');
    if (!quantityField.value || parseInt(quantityField.value) < 1) {
      quantityField.value = 1;
    }
    const unitPriceField = document.querySelector('input[name="unit_price"]');
    if (!unitPriceField.value || parseInt(unitPriceField.value) < 0) {
      unitPriceField.value = 0;
    }
  }
</script>
{% endblock %}
